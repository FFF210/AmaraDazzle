<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.review">

<!-- =================소비자=================== -->
<!-- 상품 ID로 해당 상품의 리뷰 목록 조회 (공개된 것만) -->
    <select id="selectReviewsByProductId" parameterType="Long" resultType="dto.Review">
        SELECT * FROM review
        WHERE product_id = #{productId}
        AND status = 'PUBLISHED'
        ORDER BY questioned_at DESC
        LIMIT 10
    </select>
    
    <!-- 상품의 리뷰 요약 정보 조회 -->
    <select id="getReviewSummaryByProductId" parameterType="Long" resultType="java.util.Map">
        SELECT 
            COUNT(*) as totalCount,
            AVG(rating) as averageRating,
            SUM(CASE WHEN rating = 5 THEN 1 ELSE 0 END) as rating5Count,
            SUM(CASE WHEN rating = 4 THEN 1 ELSE 0 END) as rating4Count,
            SUM(CASE WHEN rating = 3 THEN 1 ELSE 0 END) as rating3Count,
            SUM(CASE WHEN rating = 2 THEN 1 ELSE 0 END) as rating2Count,
            SUM(CASE WHEN rating = 1 THEN 1 ELSE 0 END) as rating1Count
        FROM review
        WHERE product_id = #{productId}
        AND status = 'PUBLISHED'
    </select>

</mapper>