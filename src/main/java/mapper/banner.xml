<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.banner">

	<!-- <id property="bannerId" column="banner_id" /> 배너 광고 신청 ID (PK) -->
	<!-- <result property="brandId" column="brand_id" /> 브랜드 관리자 ID (FK → brand.brand_id) -->
	<!-- <result property="managerName" column="manager_name" /> 담당자명 -->
	<!-- <result property="managerTel" column="manager_tel" /> 연락처 -->
	<!-- <result property="startDate" column="start_date" /> 시작일 -->
	<!-- <result property="endDate" column="end_date" /> 종료일 -->
	<!-- <result property="bannerName" column="banner_name" /> 배너 광고명 -->
	<!-- <result property="bannerMessage" column="banner_message" /> 관리자 전달사항 -->
	<!-- <result property="status" column="status" /> 진행상황 (PENDING/ONGOING/COMPLETED/CANCELED) -->
	<!-- <result property="createdAt" column="created_at" /> 신청일 (DEFAULT CURRENT_TIMESTAMP) -->
	<!-- <result property="updatedAt" column="updated_at" /> 수정일 -->
	<!-- <result property="isExposed" column="is_exposed" /> 노출 여부 (TINYINT, 
		DEFAULT 1) -->
	<!-- <result property="brandUrl" column="brand_url" /> 브랜드 페이지 URL -->
	<!-- <result property="stateChange" column="state_change" /> 배너 게시 상태 (POSTING 
		/ OFF) -->
	<!-- <result property="adminId" column="admin_id" /> 승인 관리자 ID (FK → admin_info.admin_info_id) -->


	<!-- brand2 -->

	<!-- 결제 성공 후 배너 신청 -->
	<!-- <insert id="insertBannerForm" parameterType="banner"> insert into banner 
		(brand_id, manager_name, manager_tel, start_date, end_date, banner_name, 
		banner_message, status, brand_url) values(#{brandId}, #{managerName}, #{managerTel}, 
		#{startDate}, #{endDate}, #{bannerName}, #{bannerMessage}, 'PENDING', #{brandUrl} 
		) </insert> <update id="update" parameterType="banner"> UPDATE banner SET 
		manager_name = #{managerName}, manager_tel = #{managerTel}, updated_at = 
		NOW(), start_date = #{startDate}, end_date = #{endDate}, banner_name = #{bannerName}, 
		banner_message = #{bannerMessage}, status = #{status}, brand_url = #{brandUrl}, 
		is_exposed = #{isExposed}, state_change = #{stateChange}, admin_id = #{adminId} 
		WHERE banner_id = #{bannerId} </update> -->

	<!-- 배너 광고 신청 목록 조회 -->
	<select id="selectAdbannerList" parameterType="map"
		resultType="bannerList">
		SELECT
		b.banner_id,
		b.brand_id,
		b.manager_name,
		b.manager_tel,
		b.start_date,
		b.end_date,
		b.banner_name,
		b.banner_message,
		b.status,
		b.created_at,
		b.updated_at,
		b.is_exposed,
		b.brand_url,
		b.state_change,
		b.admin_id
		FROM
		banner b
		<where>
			<!-- 상태 필터링 -->
			<if test="status != null and status != ''">
				AND b.status = #{status}
			</if>

			<!-- 검색 유형 : 이름/연락처/광고명 -->
			<if
				test="searchType != null and searchKeyword != null and searchKeyword != ''">
				<choose>
					<when test="searchType eq 'managerName'">
						AND b.manager_name LIKE CONCAT('%', #{searchKeyword}, '%')
					</when>
					<when test="searchType eq 'managerTel'">
						AND b.manager_tel LIKE CONCAT('%', #{searchKeyword}, '%')
					</when>
					<when test="searchType eq 'bannerName'">
						AND b.banner_name LIKE CONCAT('%', #{searchKeyword}, '%')
					</when>
				</choose>
			</if>
		</where>
		ORDER BY b.banner_id DESC
		LIMIT #{limit} OFFSET #{offset}
	</select>

	<!-- 배너 광고 신청 개수 조회 -->
	<select id="selectAdbannerCount" parameterType="map"
		resultType="int">
		SELECT COUNT(*)
		FROM banner b
		<where>
			<!-- 상태 필터링 (예: 진행중, 대기, 취소 등) -->
			<if test="status != null and status != ''">
				AND b.status = #{status}
			</if>

			<!-- 검색 유형 : 이름/연락처/광고명 등 -->
			<if
				test="searchType != null and searchKeyword != null and searchKeyword != ''">
				<choose>
					<when test="searchType eq 'managerName'">
						AND b.manager_name LIKE CONCAT('%',
						#{searchKeyword}, '%')
					</when>
					<when test="searchType eq 'managerTel'">
						AND b.manager_tel LIKE CONCAT('%',
						#{searchKeyword}, '%')
					</when>
					<when test="searchType eq 'bannerName'">
						AND b.banner_name LIKE CONCAT('%',
						#{searchKeyword}, '%')
					</when>
				</choose>
			</if>
		</where>
	</select>

	<!-- brand2 -->

</mapper>