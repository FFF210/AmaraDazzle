<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.eventApplication">

	<!-- ========= [brand2] 이벤트 신청하기 ========= -->

	<!-- 1. event_application 저장 -->
	<insert id="insertEventApplication"
		parameterType="eventApplication" useGeneratedKeys="true"
		keyProperty="eventApplicationId">
		INSERT INTO event_application (
		event_id, brand_id,
		manager_name, manager_tel, note
		)
		VALUES (
		#{eventId}, #{brandId},
		#{managerName}, #{managerTel}, #{note}
		)
	</insert>

	<!-- 2. 신청 시 product.event_id 세팅 -->
	<update id="updateProductsEvent" parameterType="map">
		UPDATE product
		SET event_id = #{eventId},
		discount_type = #{discountType},
		discount_value = #{discountValue}
		WHERE brand_id = #{brandId}
		AND product_id IN
		<foreach collection="productIdList" item="pid" open="("
			separator="," close=")">
			#{pid}
		</foreach>
	</update>


	<!-- 3. 쿠폰 발급 (reason에 event_application 연동) -->
	<!-- reason 컬럼에 event_application:{id}를 기록해서 신청과 쿠폰 연결 -->
	<insert id="insertCoupon" parameterType="coupon"
		useGeneratedKeys="true" keyProperty="couponId">
		INSERT INTO coupon (
		cname,
		start_date, end_date, amount_condition, amount,
		reason, provision,
		writer_type, writer_id
		)
		VALUES (
		#{cname}, #{startDate}, #{endDate},
		#{amountCondition}, #{amount},
		#{reason}, #{provision}, #{writerType},
		#{writerId}
		)
	</insert>

	<!-- ========= [brand2] 이벤트 신청 삭제하기 버튼 ========= -->
	<delete id="deleteEventApplication" parameterType="java.lang.Long">
		DELETE FROM
		event_application
		WHERE event_application_id = #{eventApplicationId}
	</delete>

</mapper>